<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AppIntegradora10A.Views.ListReportePage"
             Title="Lista de Reportes"
             BackgroundColor="#F8F9FA">

    <ContentPage.Resources>
        <Style x:Key="HeaderLabelStyle" TargetType="Label">
            <Setter Property="TextColor" Value="White"/>
            <Setter Property="FontAttributes" Value="Bold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="HorizontalOptions" Value="Start"/>
            <Setter Property="VerticalOptions" Value="Center"/>
        </Style>

        <Style x:Key="CellLabelStyle" TargetType="Label">
            <Setter Property="VerticalOptions" Value="Center"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="TextColor" Value="#2C3E50"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="LineBreakMode" Value="TailTruncation"/>
        </Style>

        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="TextColor" Value="White"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontAttributes" Value="Bold"/>
            <Setter Property="CornerRadius" Value="15"/>
            <Setter Property="VerticalOptions" Value="Center"/>
            <Setter Property="WidthRequest" Value="70"/>
            <Setter Property="HeightRequest" Value="30"/>
            <Setter Property="Margin" Value="2"/>
        </Style>

        <Style x:Key="FilterButtonStyle" TargetType="Button">
            <Setter Property="BackgroundColor" Value="#3498DB"/>
            <Setter Property="TextColor" Value="White"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="CornerRadius" Value="20"/>
            <Setter Property="HeightRequest" Value="35"/>
            <Setter Property="Margin" Value="2"/>
        </Style>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header con título -->
        <Frame Grid.Row="0" BackgroundColor="#3498DB" HasShadow="True" CornerRadius="0" Margin="0" Padding="20,15">
            <StackLayout Orientation="Horizontal" HorizontalOptions="Center">
                <Label Text="📋" FontSize="24" TextColor="White" VerticalOptions="Center"/>
                <Label Text="Reportes de Incidencias" 
                       FontSize="20" 
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center"/>
            </StackLayout>
        </Frame>

        <Frame BackgroundColor="#ECF0F1" HasShadow="False" CornerRadius="0" Margin="0" Padding="15,10">
            <Label x:Name="LblInfoUsuario" 
           Text="🎮 Cargando información del usuario..." 
           FontSize="12" 
           TextColor="#5D6D7E"
           HorizontalOptions="Center"
           IsVisible="False"/>
        </Frame>

        <!-- Barra de búsqueda -->
        <Frame Grid.Row="1" BackgroundColor="White" HasShadow="True" CornerRadius="25" Margin="15,10">
            <StackLayout Orientation="Horizontal">
                <Entry x:Name="SearchEntry" 
                       Placeholder="🔍 Buscar reportes..." 
                       FontSize="16"
                       HorizontalOptions="FillAndExpand"
                       TextChanged="SearchEntry_TextChanged"
                       BackgroundColor="Transparent"/>
                <Button Text="🔄" 
                        x:Name="BtnRefresh" 
                        Clicked="BtnRefresh_Clicked"
                        BackgroundColor="#27AE60"
                        TextColor="White"
                        CornerRadius="20"
                        WidthRequest="45"
                        HeightRequest="35"/>
            </StackLayout>
        </Frame>

        <!-- Filtros -->
        <ScrollView Grid.Row="2" Orientation="Horizontal" Margin="10,0">
            <StackLayout Orientation="Horizontal" Spacing="5">
                <Button Text="Todos" x:Name="BtnTodos" Clicked="BtnTodos_Clicked" Style="{StaticResource FilterButtonStyle}"/>
                <Button Text="Bug" x:Name="BtnBug" Clicked="BtnBug_Clicked" Style="{StaticResource FilterButtonStyle}"/>
                <Button Text="Crash" x:Name="BtnCrash" Clicked="BtnCrash_Clicked" Style="{StaticResource FilterButtonStyle}"/>
                <Button Text="Abiertos" x:Name="BtnAbiertos" Clicked="BtnAbiertos_Clicked" Style="{StaticResource FilterButtonStyle}"/>
                <Button Text="En Progreso" x:Name="BtnEnProgreso" Clicked="BtnEnProgreso_Clicked" Style="{StaticResource FilterButtonStyle}"/>
                <Button Text="Resueltos" x:Name="BtnResueltos" Clicked="BtnResueltos_Clicked" Style="{StaticResource FilterButtonStyle}"/>
            </StackLayout>
        </ScrollView>

        <!-- Header de la tabla -->
        <Grid Grid.Row="3" Margin="10,5,10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Frame Grid.Row="0" BackgroundColor="#34495E" HasShadow="False" CornerRadius="10,10,0,0" Padding="10,8">
                <Grid ColumnDefinitions="2*,1*,1*,1*,Auto">
                    <Label Text="INCIDENCIA" Grid.Column="0" Style="{StaticResource HeaderLabelStyle}"/>
                    <Label Text="CATEGORÍA" Grid.Column="1" Style="{StaticResource HeaderLabelStyle}"/>
                    <Label Text="ESTADO" Grid.Column="2" Style="{StaticResource HeaderLabelStyle}"/>
                    <Label Text="FECHA" Grid.Column="3" Style="{StaticResource HeaderLabelStyle}"/>
                    <Label Text="ACCIONES" Grid.Column="4" Style="{StaticResource HeaderLabelStyle}" HorizontalOptions="Center"/>
                </Grid>
            </Frame>

            <!-- Lista de reportes -->
            <Frame Grid.Row="1" BackgroundColor="White" HasShadow="True" CornerRadius="0,0,10,10" Padding="0">
                <CollectionView x:Name="ReporteCollectionView" BackgroundColor="Transparent">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="10,8" ColumnDefinitions="2*,1*,1*,1*,Auto">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnReporteTapped"/>
                                </Grid.GestureRecognizers>

                                <!-- Separador visual -->
                                <BoxView Grid.ColumnSpan="5" 
                                         Color="#ECF0F1" 
                                         HeightRequest="1" 
                                         VerticalOptions="End"
                                         HorizontalOptions="FillAndExpand"/>

                                <!-- Información del reporte -->
                                <StackLayout Grid.Column="0" Spacing="2">
                                    <Label Text="{Binding TipoIncidencia}" 
                                           Style="{StaticResource CellLabelStyle}"
                                           FontAttributes="Bold"/>
                                    <Label Text="{Binding UsuarioReportador}" 
                                           FontSize="11" 
                                           TextColor="#7F8C8D"/>
                                </StackLayout>

                                <Label Text="{Binding CategoriaTexto}" 
                                       Grid.Column="1" 
                                       Style="{StaticResource CellLabelStyle}"/>

                                <!-- Estado con color -->
                                <Frame Grid.Column="2" 
                                       BackgroundColor="{Binding EstadoColor}"
                                       CornerRadius="10"
                                       Padding="8,4"
                                       HasShadow="False"
                                       VerticalOptions="Center">
                                    <Label Text="{Binding EstadoTexto}" 
                                           TextColor="White"
                                           FontSize="11"
                                           FontAttributes="Bold"
                                           HorizontalOptions="Center"/>
                                </Frame>

                                <StackLayout Grid.Column="3" Spacing="2">
                                    <Label Text="{Binding FechaTexto}" 
                                           Style="{StaticResource CellLabelStyle}"
                                           FontSize="11"/>
                                    <Label Text="{Binding PrioridadTexto}" 
                                           FontSize="10" 
                                           TextColor="#E67E22"
                                           FontAttributes="Bold"/>
                                </StackLayout>

                                <!-- Botones de acción -->
                                <StackLayout Grid.Column="4" 
                                            Orientation="Horizontal" 
                                            HorizontalOptions="Center" 
                                            VerticalOptions="Center" 
                                            Spacing="3">
                                    <Button Text="✏️" 
                                            x:Name="BtnEditReporte" 
                                            Clicked="BtnEditReporte_Clicked" 
                                            BackgroundColor="#F39C12"
                                            Style="{StaticResource ActionButtonStyle}"
                                            WidthRequest="35"/>
                                    <Button Text="🗑️" 
                                            x:Name="BtnDeleteReporte" 
                                            Clicked="BtnDeleteReporte_Clicked" 
                                            BackgroundColor="#E74C3C"
                                            Style="{StaticResource ActionButtonStyle}"
                                            WidthRequest="35"/>
                                    <Button Text="✅" 
                                            x:Name="BtnResolverReporte" 
                                            Clicked="BtnResolverReporte_Clicked" 
                                            BackgroundColor="#27AE60"
                                            Style="{StaticResource ActionButtonStyle}"
                                            WidthRequest="35"/>
                                </StackLayout>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Frame>
        </Grid>

        <!-- Footer con estadísticas -->
        <Frame Grid.Row="4" BackgroundColor="#34495E" HasShadow="True" CornerRadius="0" Margin="0" Padding="15,10">
            <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="20">
                <StackLayout Orientation="Horizontal" Spacing="5">
                    <Label Text="📊" TextColor="White" FontSize="16"/>
                    <Label x:Name="LblTotalReportes" 
                           Text="Total: 0" 
                           TextColor="White" 
                           FontAttributes="Bold"/>
                </StackLayout>
                <StackLayout Orientation="Horizontal" Spacing="5">
                    <Label Text="🔴" TextColor="#E74C3C" FontSize="16"/>
                    <Label x:Name="LblReportesAbiertos" 
                           Text="Abiertos: 0" 
                           TextColor="White"/>
                </StackLayout>
                <StackLayout Orientation="Horizontal" Spacing="5">
                    <Label Text="🟢" TextColor="#27AE60" FontSize="16"/>
                    <Label x:Name="LblReportesResueltos" 
                           Text="Resueltos: 0" 
                           TextColor="White"/>
                </StackLayout>
            </StackLayout>
        </Frame>

        <!-- Loading Indicator -->
        <Frame Grid.RowSpan="5" 
               BackgroundColor="#80000000" 
               IsVisible="{Binding Source={x:Reference LoadingIndicator}, Path=IsVisible}"
               HasShadow="False">
            <ActivityIndicator x:Name="LoadingIndicator" 
                               IsVisible="False" 
                               IsRunning="False"
                               Color="#3498DB"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               HeightRequest="50"/>
        </Frame>
    </Grid>

</ContentPage>